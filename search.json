[
  {
    "objectID": "core.html",
    "href": "core.html",
    "title": "core",
    "section": "",
    "text": "source\n\nfoo\n\n foo ()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "llama-self-taught-reasoner",
    "section": "",
    "text": "This file will become your README and also the index of your documentation."
  },
  {
    "objectID": "index.html#install",
    "href": "index.html#install",
    "title": "llama-self-taught-reasoner",
    "section": "Install",
    "text": "Install\npip install llama_self_taught_reasoner"
  },
  {
    "objectID": "index.html#how-to-use",
    "href": "index.html#how-to-use",
    "title": "llama-self-taught-reasoner",
    "section": "How to use",
    "text": "How to use\nFill me in please! Don’t forget code examples:\n\n1+1\n\n2"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html",
    "href": "01_train_chains_of_thoughts.html",
    "title": "Reading data",
    "section": "",
    "text": "import pandas as pd\nimport json\nfrom llama_4bit_wrapper import import_llama\nfrom llama_4bit_wrapper.core import Matmul4BitOptions\nimport numpy as np\nimport torch\nimport torch.nn.functional as F\nfrom tqdm.notebook import tqdm\nimport os\ndf_data = pd.read_csv(\"llama-reasoning.csv\")\ndf_data[\"variables\"] = df_data[\"variables\"].apply(json.loads)\ndf_data.head()\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nThis question refers to the following informat...\n{'A': 'The ideas of personal liberty and natio...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n1\nThis question refers to the following informat...\n{'A': 'Capitalist', 'B': 'Scientific', 'C': 'C...\nC\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n2\nThis question refers to the following informat...\n{'A': 'They served as a catalyst for the growt...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n3\nThis question refers to the following informat...\n{'A': 'give the English king a new position of...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n4\nThis question refers to the following informat...\n{'A': 'His domination of the nobility left him...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntest\ndf_data.loc[df_data[\"dataset\"] == \"gsm8k\"]\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n828\nArtemis is making tea for a party. She knows h...\n{'chain_of_thoughts': 'She is making 72 ounces...\n9\ngsm8k\ngsm8k\ngsm8k\nvalidation\n\n\n829\nIt's Ava's birthday party. Her parents bought ...\n{'chain_of_thoughts': 'The four bags of Reese'...\n99\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n830\nLee mows one lawn and charges $33. Last week h...\n{'chain_of_thoughts': '33 * 16 = $&lt;&lt;33*16=528&gt;...\n558\ngsm8k\ngsm8k\ngsm8k\nvalidation\n\n\n831\nCarly collected 7 starfish with 5 arms each an...\n{'chain_of_thoughts': 'First find the total nu...\n49\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n832\nHannah sold 40 pieces of cookies for $0.8 each...\n{'chain_of_thoughts': 'Hannah's earnings from ...\n79\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n1123\nBud makes homemade macaroni and cheese once a ...\n{'chain_of_thoughts': 'The gruyere cheese is t...\n520\ngsm8k\ngsm8k\ngsm8k\ntest\n\n\n1124\nA farm has 10 2-legged animals and 15 4-legged...\n{'chain_of_thoughts': '2-legged animals have 2...\n40\ngsm8k\ngsm8k\ngsm8k\ntest\n\n\n1125\nThe recent floods in Mamou’s country have left...\n{'chain_of_thoughts': 'On Friday, Saturday and...\n1218\ngsm8k\ngsm8k\ngsm8k\ntest\n\n\n1126\nJake is shopping at a clothing store. The stor...\n{'chain_of_thoughts': 'The cost of a T-shirt a...\n36\ngsm8k\ngsm8k\ngsm8k\ntest\n\n\n1127\nJanet goes to the mall and spends $3.50 on ice...\n{'chain_of_thoughts': 'First calculate the cos...\n13\ngsm8k\ngsm8k\ngsm8k\ntest\n\n\n\n\n300 rows × 7 columns\ndf_formatters = pd.read_csv(\"formatters.csv\")\ndf_formatters.head()\n\n\n\n\n\n\n\n\nformatter\ntext\n\n\n\n\n0\nbbh-boolean_expressions\nUSER: Calculate the following expression {ques...\n\n\n1\nbbh-boolean_expressions-no-cot\nUSER: Calculate the following expression {ques...\n\n\n2\nbbh-boolean_expressions-cot\nUSER: Calculate the following expression {ques...\n\n\n3\nbbh-causal_judgement\nUSER: {question}. &lt;s&gt; ASSISTANT: Let's think s...\n\n\n4\nbbh-causal_judgement-cot\nUSER: {question}. &lt;s&gt; ASSISTANT: Let's think s..."
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#applying-formatters",
    "href": "01_train_chains_of_thoughts.html#applying-formatters",
    "title": "Reading data",
    "section": "Applying formatters",
    "text": "Applying formatters\n\ndef row_apply_formatters(row, df_formatters, suffix):\n    pattern = df_formatters.loc[df_formatters[\"formatter\"] == row[\"formatter\"] + suffix, \"text\"].values[0]\n    data = dict(row)\n    data = dict(data, **row[\"variables\"])\n    return pattern.format(**data)\n\n\ndef apply_formatters(df_data, df_formatters, suffix):\n    return df_data.apply(\n        lambda row: row_apply_formatters(row, df_formatters, suffix),\n        axis=1\n    ).tolist()\n\n\ndf_data.groupby(\"split\")[[\"question\"]].count()\n\n\n\n\n\n\n\n\nquestion\n\n\nsplit\n\n\n\n\n\ntest\n565\n\n\ntrain\n479\n\n\nvalidation\n548\n\n\n\n\n\n\n\n\napply_formatters(\n    df_data,\n    df_formatters,\n    \"-no-cot\"\n)[:3]\n\n['USER: This question refers to the following information.\\nRead the following excerpt.\\nThe revolutionary seed had penetrated into every country and spread more or less. It was greatly developed under the régime of the military despotism of Bonaparte. His conquests displaced a number of laws, institutions, and customs; broke through bonds sacred among all nations, strong enough to resist time itself; which is more than can be said of certain benefits conferred by these innovators.\\nThe monarchs will fulfil the duties imposed upon them by Him who, by entrusting them with power, has charged them to watch over the maintenance of justice, and the rights of all, to avoid the paths of error, and tread firmly in the way of truth. Placed beyond the passions which agitate society, it is in days of trial chiefly that they are called upon to despoil realities of their false appearances, and to show themselves as they are, fathers invested with the authority belonging by right to the heads of families, to prove that, in days of mourning, they know how to be just, wise, and therefore strong, and that they will not abandon the people whom they ought to govern to be the sport of factions, to error and its consequences, which must involve the loss of society.\\nUnion between the monarchs is the basis of the policy which must now be followed to save society from total ruin. . . .\\nLet them not confound concessions made to parties with the good they ought to do for their people, in modifying, according to their recognized needs, such branches of the administration as require it.\\nLet them be just, but strong; beneficent, but strict.\\nLet them maintain religious principles in all their purity, and not allow the faith to be attacked and morality interpreted according to the social contract or the visions of foolish sectarians.\\nLet them suppress Secret Societies; that gangrene of society.\\n—Klemens von Metternich, Political Confession of Faith, 1820\\nWhich of the following was the greatest cause of the fears expressed by Metternich in the document above?\\nA: The ideas of personal liberty and nationalism conceived during the Enlightenment resulted in radical revolutions that could spread throughout Europe.\\nB: The conquest of Europe by Napoleon led to the creation of new factions and shifted the European balance of power.\\nC: The power of monarchs had grown to the point where it needed to be checked by other powers within each nation or domination of civilians would occur.\\nD: The rising and falling economic cycle of the newly emerging capitalist economy could lead to civilian unrest that must be suppressed.\\nGive an immediate answer. &lt;s&gt; ASSISTANT: A &lt;s&gt;',\n 'USER: This question refers to the following information.\\nIn Russia there was nothing going on well, and [Souvarine] was in despair over the news he had received. His old companions were all turning to the politicians; the famous Nihilists who made Europe tremble-sons of village priests, of the lower middle class, of tradesmen-could not rise above the idea of national liberation, and seemed to believe that the world would be delivered-when they had killed their despot&…\\n\"Foolery! They\\'ll never get out of it with their foolery.\"\\nThen, lowering his voice still more, in a few bitter words he described his old dream of fraternity. He had renounced his rank and his fortune; he had gone among workmen, only in the hope of seeing at last the foundation of a new society of labour in common. All the sous in his pockets had long gone to the urchins of the settlement; he had been as tender as a brother with the colliers, smiling at their suspicion, winning them over by his quiet workmanlike ways and his dislike of chattering. But decidedly the fusion had not taken place.\\nHis voice changed, his eyes grew bright, he fixed them on étienne, directly addressing him:\\n\"Now, do you understand that? These hatworkers at Marseilles who have won the great lottery prize of a hundred thousand francs have gone off at once and invested it, declaring that they are going to live without doing anything! Yes, that is your idea, all of you French workmen; you want to unearth a treasure in order to devour it alone afterwards in some lazy, selfish corner. You may cry out as much as you like against the rich, you haven\\'t got courage enough to give back to the poor the money that luck brings you. You will never be worthy of happiness as long as you own anything, and your hatred of the bourgeois proceeds solely from an angry desire to be bourgeois yourselves in their place.\"\\némile Zola, French writer, Germinal, 1885\\nThe passage displays the direct concern for the welfare of the working classes that was typically a part of which movement?\\nA: Capitalist\\nB: Scientific\\nC: Communist\\nD: Existentialist\\nGive an immediate answer. &lt;s&gt; ASSISTANT: C &lt;s&gt;',\n \"USER: This question refers to the following information.\\nThe excerpts below are from the Navigation Acts of 1651.\\n[A]fter the first day of December, one thousand six hundred fifty and one, and from thence forwards, no goods or commodities whatsoever of the growth, production or manufacture of Asia, Africa or America, or of any part thereof; or of any islands belonging to them, or which are described or laid down in the usual maps or cards of those places, as well of the English plantations as others, shall be imported or brought into this Commonwealth of England, or into Ireland, or any other lands, islands, plantations, or territories to this Commonwealth belonging, or in their possession, in any other ship or ships, vessel or vessels whatsoever, but only in such as do truly and without fraud belong only to the people of this Commonwealth, or the plantations thereof, as the proprietors or right owners thereof; and whereof the master and mariners are also of the people of this Commonwealth, under the penalty of the forfeiture and loss of all the goods that shall be imported contrary to this act, , , ,\\n[N]o goods or commodities of the growth, production, or manufacture of Europe, or of any part thereof, shall after the first day of December, one thousand six hundred fifty and one, be imported or brought into this Commonwealth of England, or any other lands or territories to this Commonwealth belonging, or in their possession, in any ship or ships, vessel or vessels whatsoever, but in such as do truly and without fraud belong only to the people of this Commonwealth, and in no other, except only such foreign ships and vessels as do truly and properly belong to the people of that country or place, of which the said goods are the growth, production or manufacture.\\nWhich of the following best describes the outcome of the Navigation Acts of 1651?\\nA: They served as a catalyst for the growth of English shipping and overseas trade, but did little to limit the prospects of the Dutch in the seventeenth century.\\nB: They brought about almost immediate hardships for the Dutch economy as their dominance of overseas trade quickly ended.\\nC: They were rescinded during the restoration of the Stuarts as they sought normal diplomatic relations with the Dutch so not as to need Parliament's financial support for war.\\nD: They led to nearly a century of recurrent war between England and the Netherlands, which would not end until after American independence.\\nGive an immediate answer. &lt;s&gt; ASSISTANT: A &lt;s&gt;\"]"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#searching-for-last-assistant-answer",
    "href": "01_train_chains_of_thoughts.html#searching-for-last-assistant-answer",
    "title": "Reading data",
    "section": "Searching for last “ASSISTANT:” answer",
    "text": "Searching for last “ASSISTANT:” answer\nTo calculate perplexity only on the final answer I should find this answer in the prompt, so I wrote the following function.\n\ndef last_subsequence_start(sequence, subsequence):\n    seq_len = len(sequence)\n    subseq_len = len(subsequence)\n\n    for i in range(seq_len - 1, subseq_len - 2, -1):\n        if sequence[i] == subsequence[-1]:\n            match = True\n            for j in range(subseq_len):\n                if sequence[i - j] != subsequence[-(j + 1)]:\n                    match = False\n                    break\n            if match:\n                return i - subseq_len + 1\n    \n    return -1\n\n\nlast_subsequence_start([1, 2, 3, 4, 2, 3, 5], [2, 3])\n\n4"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#loading-llama",
    "href": "01_train_chains_of_thoughts.html#loading-llama",
    "title": "Reading data",
    "section": "Loading LLAMA",
    "text": "Loading LLAMA\n\nLLAMA_MODEL = \"./Llama-2-13B-chat-GPTQ-localmodels/\"\nLLAMA_WEIGHTS = \"./Llama-2-13B-chat-GPTQ-localmodels/gptq_model-4bit-128g.safetensors\"\n\n\n_, _, load_llama_model_4bit_low_ram, _, model_to_half, _, _, _, AMPWrapper = import_llama(\n    use_flash_attention=False,\n    use_xformers=False,\n    autograd_4bit_cuda=True,\n    autograd_4bit_triton=False,\n    matmul4bit_options=Matmul4BitOptions.NO_ACT_ORDER | Matmul4BitOptions.ALGORYTHM_FASTER,\n)\n\nTriton not found. Please run \"pip install triton\".\nUsing CUDA implementation.\n\n\n\nllama, tokenizer = load_llama_model_4bit_low_ram(\n    config_path=LLAMA_MODEL,\n    model_path=LLAMA_WEIGHTS,\n    groupsize=128,\n    half=True,\n    device_map='auto',\n    seqlen=2048,\n    is_v1_model=False,\n    bits=4,\n)\n\nLoading Model ...\nConverted as Half.\nLoaded the model in 6.83 seconds.\n\n\nThe safetensors archive passed at ./Llama-2-13B-chat-GPTQ-localmodels/gptq_model-4bit-128g.safetensors does not contain metadata. Make sure to save your model with the `save_pretrained` method. Defaulting to 'pt' metadata.\nYou are using the legacy behaviour of the &lt;class 'transformers.models.llama.tokenization_llama.LlamaTokenizer'&gt;. This means that tokens that come after special tokens will not be properly handled. We recommend you to read the related pull request available at https://github.com/huggingface/transformers/pull/24565\n\n\n\ntokenizer.pad_token_id = 0\n\n\namp_wrapper = AMPWrapper(llama)\namp_wrapper.apply_forward()\namp_wrapper.apply_generate()"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#checking-prompts",
    "href": "01_train_chains_of_thoughts.html#checking-prompts",
    "title": "Reading data",
    "section": "Checking prompts",
    "text": "Checking prompts\n\nlast_assistant_response_tokens = tokenizer.encode(\"ASSISTANT:\")[1:]\n\n\nfor token in last_assistant_response_tokens:\n    print(tokenizer.convert_ids_to_tokens([token]), token)\n\n['▁A'] 319\n['SS'] 1799\n['IST'] 9047\n['ANT'] 13566\n[':'] 29901\n\n\n\nassert all([\n    last_subsequence_start(tokenizer.encode(text), last_assistant_response_tokens) != -1\n    for text in apply_formatters(\n        df_data,\n        df_formatters,\n        \"-no-cot\"\n    )\n])\n\n\nassert all([\n    last_subsequence_start(tokenizer.encode(text), last_assistant_response_tokens) != -1\n    for text in apply_formatters(\n        df_data,\n        df_formatters,\n        \"\"\n    )\n])\n\n\nassert all([\n    last_subsequence_start(tokenizer.encode(text), last_assistant_response_tokens) != -1\n    for text in apply_formatters(\n        df_data.assign(chain_of_thoughts=\"\"),\n        df_formatters,\n        \"-cot\"\n    )\n])"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#calculating-answers-perplexity",
    "href": "01_train_chains_of_thoughts.html#calculating-answers-perplexity",
    "title": "Reading data",
    "section": "Calculating answers perplexity",
    "text": "Calculating answers perplexity\n\ndef get_text_length_sorted_dataframe(texts):\n    df = pd.DataFrame({\n        \"text\": texts,\n    })\n    df[\"length\"] = df[\"text\"].str.len()\n    df[\"index\"] = list(range(len(texts)))\n    df = df.sort_values(\"length\")\n    return df\n\n\ndef get_batch_perplexities(llama, tokenizer, batch_texts, last_assistant_response_tokens):\n    batch_size = len(batch_texts)\n    batch = tokenizer.batch_encode_plus(\n        batch_texts,\n        return_tensors=\"pt\",\n        padding=True,\n    )\n    batch = {\n        key: value.to(llama.device)\n        for key, value in batch.items()\n    }\n    llama.eval()\n    with torch.no_grad():\n        logits = llama(**batch).logits\n        probas = F.softmax(logits, dim=-1)\n    input_ids_np = batch[\"input_ids\"].detach().cpu().numpy()\n    attention_mask_np = batch[\"attention_mask\"].detach().cpu().numpy()\n    probas_np = probas.detach().cpu().numpy()\n    perplexities = []\n    for i in range(batch_size):\n        item_mask = attention_mask_np[i].astype(np.bool_)\n        item_input_ids = input_ids_np[i][item_mask]\n        item_probas = probas_np[i][item_mask]\n        answer_start_token_index = last_subsequence_start(item_input_ids, last_assistant_response_tokens)\n        # Exclude ending &lt;s&gt; token\n        answer_labels = item_input_ids[answer_start_token_index + len(last_assistant_response_tokens):-1]\n        answer_probas = item_probas[answer_start_token_index + len(last_assistant_response_tokens) - 1:-2]\n        answer_token_probas = []\n        for i, token in enumerate(answer_labels):\n            answer_token_probas.append(answer_probas[i, token])\n        answer_token_probas = np.array(answer_token_probas)\n        perplexity = np.exp(-np.log(answer_token_probas).mean())\n        perplexities.append(perplexity)\n    return perplexities\n\n\ndef get_answers_perplexity(llama, tokenizer, texts, last_assistant_response_tokens, batch_size):\n    tokenizer.padding_side = 'right'\n    df = get_text_length_sorted_dataframe(texts)\n    batch_count = int(np.ceil(len(df) / batch_size))\n    perplexities = np.zeros([len(texts)], dtype=np.float32)\n    batch_indices = np.arange(batch_count, dtype=np.int32)\n    batch_indices = pd.Series(batch_indices).sample(len(batch_indices), random_state=42).values\n    for batch_index in tqdm(batch_indices):\n        df_batch = df.iloc[batch_index * batch_size : (batch_index + 1) * batch_size]\n        batch_real_size = len(df_batch)\n        texts_batch = df_batch[\"text\"].tolist()\n        batch_perplexities = get_batch_perplexities(llama, tokenizer, texts_batch, last_assistant_response_tokens)\n        perplexities[batch_index * batch_size : batch_index * batch_size + batch_real_size] = batch_perplexities\n    df[\"perplexity\"] = perplexities\n    df = df.sort_values(\"index\")\n    return df[\"perplexity\"].values"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#calculate-initial-answers-perplexity",
    "href": "01_train_chains_of_thoughts.html#calculate-initial-answers-perplexity",
    "title": "Reading data",
    "section": "Calculate initial answers perplexity",
    "text": "Calculate initial answers perplexity\n\ndef get_iteration_no_cot_perplexities(step, llama, tokenizer, df_data, df_formatters,\n                                      last_assistant_response_tokens, batch_size):\n    df_data = df_data.copy()\n    fname = f\"cached-{step}-no-cot-perplexities.csv\"\n    if not os.path.exists(fname):\n        df_data[\"no_cot_perplexity\"] = get_answers_perplexity(\n            llama,\n            tokenizer,\n            apply_formatters(\n                df_data,\n                df_formatters,\n                \"-no-cot\"\n            ),\n            last_assistant_response_tokens,\n            batch_size,\n        )\n        df_data[\"variables\"] = df_data[\"variables\"].apply(json.dumps)\n        df_data.to_csv(fname, index=False)\n    df_data = pd.read_csv(fname)\n    df_data[\"variables\"] = df_data[\"variables\"].apply(json.loads)\n    return df_data\n\n\ndf_data = get_iteration_no_cot_perplexities(\n    step=0,\n    llama=llama,\n    tokenizer=tokenizer,\n    df_data=df_data,\n    df_formatters=df_formatters,\n    last_assistant_response_tokens=last_assistant_response_tokens,\n    batch_size=4\n)\ndf_data.head()\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\nno_cot_perplexity\n\n\n\n\n0\nThis question refers to the following informat...\n{'A': 'The ideas of personal liberty and natio...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n1444.3512\n\n\n1\nThis question refers to the following informat...\n{'A': 'Capitalist', 'B': 'Scientific', 'C': 'C...\nC\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n2706.0737\n\n\n2\nThis question refers to the following informat...\n{'A': 'They served as a catalyst for the growt...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n2104.2961\n\n\n3\nThis question refers to the following informat...\n{'A': 'give the English king a new position of...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n5377.2250\n\n\n4\nThis question refers to the following informat...\n{'A': 'His domination of the nobility left him...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntest\n11120.2450\n\n\n\n\n\n\n\n\ndf_data[\"no_cot_perplexity\"].mean()\n\n2680.1576499624375"
  },
  {
    "objectID": "01_train_chains_of_thoughts.html#generate-chain-of-thoughts",
    "href": "01_train_chains_of_thoughts.html#generate-chain-of-thoughts",
    "title": "Reading data",
    "section": "Generate chain-of-thoughts",
    "text": "Generate chain-of-thoughts\n\nCONTRASTIVE_SEARCH_ALPHA = 0.6\nCONTRASTIVE_SEARCH_TOP_K = 4\nCOT_GENERATION_MAX_NEW_TOKENS = 64\nCOT_ANSWER_MINIMUM_TOKENS = 5\n\n\ndef get_batch_chains_of_thought(llama, tokenizer, batch_texts):\n    batch = tokenizer.batch_encode_plus(\n        batch_texts,\n        return_tensors=\"pt\",\n        padding=True,\n    )\n    batch = {\n        key: value.to(llama.device)\n        for key, value in batch.items()\n    }\n    max_position_embeddings = llama.config.max_position_embeddings\n    max_sequence_length = batch[\"attention_mask\"].sum(dim=-1).max().item()\n    max_new_tokens = COT_GENERATION_MAX_NEW_TOKENS\n    if max_sequence_length + max_new_tokens + COT_ANSWER_MINIMUM_TOKENS &gt; max_position_embeddings:\n        max_new_tokens = max_position_embeddings - max_sequence_length - COT_ANSWER_MINIMUM_TOKENS\n    llama.eval()\n    with torch.no_grad():\n        generation = llama.generate(batch[\"input_ids\"],\n                                    penalty_alpha=CONTRASTIVE_SEARCH_ALPHA,\n                                    top_k=CONTRASTIVE_SEARCH_TOP_K,\n                                    max_new_tokens=max_new_tokens,\n                                    use_cache=True)\n        generation = generation.detach().cpu().numpy()\n    batch_size = len(batch_texts)\n    result = []\n    for i in range(batch_size):\n        mask = generation[i] != tokenizer.pad_token_id\n        item_tokens = generation[i][mask]\n        prompt_token_count = (batch[\"input_ids\"][i] != tokenizer.pad_token_id).sum().item()\n        item_generation_tokens = item_tokens[prompt_token_count:]\n        item_generation_text = tokenizer.decode(item_generation_tokens)\n        item_generation_text_cleaned = item_generation_text.split(\"ASSISTANT:\")[0].split(\"USER:\")[0].strip()\n        result.append(item_generation_text_cleaned)\n    return result\n\n\ndef get_chains_of_thought(llama, tokenizer, texts, batch_size):\n    tokenizer.padding_side = 'left'\n    df = get_text_length_sorted_dataframe(texts)\n    batch_count = int(np.ceil(len(df) / batch_size))\n    batch_indices = np.arange(batch_count, dtype=np.int32)\n    batch_indices = pd.Series(batch_indices).sample(len(batch_indices), random_state=42).values\n    \n    generations = {}\n    for batch_index in tqdm(batch_indices):\n        df_batch = df.iloc[batch_index * batch_size : (batch_index + 1) * batch_size]\n        batch_real_size = len(df_batch)\n        texts_batch = df_batch[\"text\"].tolist()\n        generations_batch = get_batch_chains_of_thought(llama, tokenizer, texts_batch)\n        for i in range(batch_real_size):\n            generations[batch_index * batch_size + i] = generations_batch[i]\n    \n    df[\"chain_of_thoughts\"] = [\n        generations[i]\n        for i in range(len(texts))\n    ]\n    df = df.sort_values(\"index\")\n    return df[\"chain_of_thoughts\"].values\n\n\ndef get_iteration_chains_of_thoughts(step, llama, tokenizer, df_data, df_formatters, batch_size):\n    df_data = df_data.copy()\n    fname = f\"cached-{step}-chains-of-thoughts.csv\"\n    if not os.path.exists(fname):\n        df_data[\"chain_of_thoughts\"] = get_chains_of_thought(\n            llama,\n            tokenizer,\n            apply_formatters(\n                df_data,\n                df_formatters,\n                \"\",\n            ),\n            batch_size,\n        )\n        df_data[\"variables\"] = df_data[\"variables\"].apply(json.dumps)\n        df_data.to_csv(fname, index=False)\n    df_data = pd.read_csv(fname)\n    df_data[\"variables\"] = df_data[\"variables\"].apply(json.loads)\n    return df_data\n\n\ndf_data = get_iteration_chains_of_thoughts(\n    step=0,\n    llama=llama,\n    tokenizer=tokenizer,\n    df_data=df_data,\n    df_formatters=df_formatters,\n    batch_size=4\n)\ndf_data.head()\n\n\n\n\nOutOfMemoryError: CUDA out of memory. Tried to allocate 222.00 MiB (GPU 0; 11.00 GiB total capacity; 35.88 GiB already allocated; 0 bytes free; 36.76 GiB reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF"
  },
  {
    "objectID": "prepare_datasets.html",
    "href": "prepare_datasets.html",
    "title": "Preparing datasets",
    "section": "",
    "text": "from datasets import load_dataset\nimport pandas as pd\nimport json\nimport random\nfrom sklearn.model_selection import train_test_split\n\nC:\\Users\\alex4321\\anaconda3\\envs\\llama\\Lib\\site-packages\\tqdm\\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm"
  },
  {
    "objectID": "prepare_datasets.html#mmlu",
    "href": "prepare_datasets.html#mmlu",
    "title": "Preparing datasets",
    "section": "MMLU",
    "text": "MMLU\n\ndef load_mmlu_subset(subset):\n    print(f\"LOADING MMLU SUBSET {subset}\")\n    dataset = load_dataset(\"lukaemon/mmlu\", subset)\n    results = []\n    for split in [\"train\", \"test\", \"validation\"]:\n        df_split = pd.DataFrame(dataset[split])\n        df_split[\"split\"] = split\n        df_split[\"subset\"] = f\"mmlu-{subset}\"\n        results.append(df_split)\n    df = pd.concat(results).reset_index(drop=True)\n    df[\"dataset\"] = \"mmlu\"\n    df[\"formatter\"] = \"mmlu\"\n    df[\"question\"] = df[\"input\"]\n    df[\"variables\"] = df.apply(\n        lambda row: {\n            \"A\": row[\"A\"],\n            \"B\": row[\"B\"],\n            \"C\": row[\"C\"],\n            \"D\": row[\"D\"],\n        },\n        axis=1\n    )\n    df[\"variables\"] = df[\"variables\"].apply(json.dumps)\n    df = df[[\"question\", \"variables\", \"target\", \"dataset\", \"formatter\", \"subset\", \"split\"]]\n    return df\n\n\ndf_mmlu = [\n    load_mmlu_subset(config_name)\n    for config_name in ['high_school_european_history', 'business_ethics', 'clinical_knowledge',\n                        'medical_genetics', 'high_school_us_history', 'high_school_physics',\n                        'high_school_world_history', 'virology', 'high_school_microeconomics',\n                        'econometrics', 'college_computer_science', 'high_school_biology',\n                        'abstract_algebra', 'professional_accounting', 'philosophy',\n                        'professional_medicine', 'nutrition', 'global_facts', 'machine_learning',\n                        'security_studies', 'public_relations', 'professional_psychology',\n                        'prehistory', 'anatomy', 'human_sexuality', 'college_medicine',\n                        'high_school_government_and_politics', 'college_chemistry',\n                        'logical_fallacies', 'high_school_geography', 'elementary_mathematics',\n                        'human_aging', 'college_mathematics', 'high_school_psychology',\n                        'formal_logic', 'high_school_statistics', 'international_law',\n                        'high_school_mathematics', 'high_school_computer_science', 'conceptual_physics',\n                        'miscellaneous', 'high_school_chemistry', 'marketing',\n                        'professional_law', 'management', 'college_physics',\n                        'jurisprudence', 'world_religions', 'sociology',\n                        'us_foreign_policy', 'high_school_macroeconomics', 'computer_security',\n                        'moral_scenarios', 'moral_disputes', 'electrical_engineering',\n                        'astronomy', 'college_biology']\n]\ndf_mmlu = pd.concat(df_mmlu).reset_index(drop=True)\ndf_mmlu.head()\n\nLOADING MMLU SUBSET high_school_european_history\nLOADING MMLU SUBSET business_ethics\nLOADING MMLU SUBSET clinical_knowledge\nLOADING MMLU SUBSET medical_genetics\nLOADING MMLU SUBSET high_school_us_history\nLOADING MMLU SUBSET high_school_physics\nLOADING MMLU SUBSET high_school_world_history\nLOADING MMLU SUBSET virology\nLOADING MMLU SUBSET high_school_microeconomics\nLOADING MMLU SUBSET econometrics\nLOADING MMLU SUBSET college_computer_science\nLOADING MMLU SUBSET high_school_biology\nLOADING MMLU SUBSET abstract_algebra\nLOADING MMLU SUBSET professional_accounting\nLOADING MMLU SUBSET philosophy\nLOADING MMLU SUBSET professional_medicine\nLOADING MMLU SUBSET nutrition\nLOADING MMLU SUBSET global_facts\nLOADING MMLU SUBSET machine_learning\nLOADING MMLU SUBSET security_studies\nLOADING MMLU SUBSET public_relations\nLOADING MMLU SUBSET professional_psychology\nLOADING MMLU SUBSET prehistory\nLOADING MMLU SUBSET anatomy\nLOADING MMLU SUBSET human_sexuality\nLOADING MMLU SUBSET college_medicine\nLOADING MMLU SUBSET high_school_government_and_politics\nLOADING MMLU SUBSET college_chemistry\nLOADING MMLU SUBSET logical_fallacies\nLOADING MMLU SUBSET high_school_geography\nLOADING MMLU SUBSET elementary_mathematics\nLOADING MMLU SUBSET human_aging\nLOADING MMLU SUBSET college_mathematics\nLOADING MMLU SUBSET high_school_psychology\nLOADING MMLU SUBSET formal_logic\nLOADING MMLU SUBSET high_school_statistics\nLOADING MMLU SUBSET international_law\nLOADING MMLU SUBSET high_school_mathematics\nLOADING MMLU SUBSET high_school_computer_science\nLOADING MMLU SUBSET conceptual_physics\nLOADING MMLU SUBSET miscellaneous\nLOADING MMLU SUBSET high_school_chemistry\nLOADING MMLU SUBSET marketing\nLOADING MMLU SUBSET professional_law\nLOADING MMLU SUBSET management\nLOADING MMLU SUBSET college_physics\nLOADING MMLU SUBSET jurisprudence\nLOADING MMLU SUBSET world_religions\nLOADING MMLU SUBSET sociology\nLOADING MMLU SUBSET us_foreign_policy\nLOADING MMLU SUBSET high_school_macroeconomics\nLOADING MMLU SUBSET computer_security\nLOADING MMLU SUBSET moral_scenarios\nLOADING MMLU SUBSET moral_disputes\nLOADING MMLU SUBSET electrical_engineering\nLOADING MMLU SUBSET astronomy\nLOADING MMLU SUBSET college_biology\n\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nThis question refers to the following informat...\n{\"A\": \"The ideas of personal liberty and natio...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n1\nThis question refers to the following informat...\n{\"A\": \"Capitalist\", \"B\": \"Scientific\", \"C\": \"C...\nC\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n2\nThis question refers to the following informat...\n{\"A\": \"They served as a catalyst for the growt...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n3\nThis question refers to the following informat...\n{\"A\": \"give the English king a new position of...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n4\nThis question refers to the following informat...\n{\"A\": \"In ancient Rome, religious worship was ...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntest"
  },
  {
    "objectID": "prepare_datasets.html#gsm8k",
    "href": "prepare_datasets.html#gsm8k",
    "title": "Preparing datasets",
    "section": "GSM8K",
    "text": "GSM8K\n\ndataset_gsm8k = load_dataset(\"gsm8k\", \"main\")\ndataset_gsm8k\n\nDatasetDict({\n    train: Dataset({\n        features: ['question', 'answer'],\n        num_rows: 7473\n    })\n    test: Dataset({\n        features: ['question', 'answer'],\n        num_rows: 1319\n    })\n})\n\n\n\ndf_gsm8k = pd.concat([\n    pd.DataFrame(dataset_gsm8k[split]).assign(split=split)\n    for split in [\"train\", \"test\"]\n])\ndf_gsm8k[\"dataset\"] = \"gsm8k\"\ndf_gsm8k[\"formatter\"] = \"gsm8k\"\ndf_gsm8k[\"subset\"] = \"gsm8k\"\ndf_gsm8k[\"variables\"] = df_gsm8k[\"answer\"].apply(lambda answer: answer.split(\"####\")[0].strip())\\\n    .apply(lambda cot: {\"chain_of_thoughts\": cot}) \\\n    .apply(json.dumps)\ndf_gsm8k[\"target\"] = df_gsm8k[\"answer\"].apply(lambda answer: answer.split(\"####\")[1].strip())\ndf_gsm8k = df_gsm8k[[\"question\", \"variables\", \"target\", \"dataset\", \"formatter\", \"subset\", \"split\"]]\ndf_gsm8k.head()\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nNatalia sold clips to 48 of her friends in Apr...\n{\"chain_of_thoughts\": \"Natalia sold 48/2 = &lt;&lt;4...\n72\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n1\nWeng earns $12 an hour for babysitting. Yester...\n{\"chain_of_thoughts\": \"Weng earns 12/60 = $&lt;&lt;1...\n10\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n2\nBetty is saving money for a new wallet which c...\n{\"chain_of_thoughts\": \"In the beginning, Betty...\n5\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n3\nJulie is reading a 120-page book. Yesterday, s...\n{\"chain_of_thoughts\": \"Maila read 12 x 2 = &lt;&lt;1...\n42\ngsm8k\ngsm8k\ngsm8k\ntrain\n\n\n4\nJames writes a 3-page letter to 2 different fr...\n{\"chain_of_thoughts\": \"He writes each friend 3...\n624\ngsm8k\ngsm8k\ngsm8k\ntrain"
  },
  {
    "objectID": "prepare_datasets.html#bbh",
    "href": "prepare_datasets.html#bbh",
    "title": "Preparing datasets",
    "section": "BBH",
    "text": "BBH\n\ndef load_bbh_subset(subset):\n    print(f\"LOAD BBH {subset} SUBSET\")\n    dataset = load_dataset(\"lukaemon/bbh\", subset)\n    df = pd.DataFrame(dataset[\"test\"])\n    df[\"question\"] = df[\"input\"]\n    df[\"variables\"] = \"{}\"\n    df[\"dataset\"] = \"bbh\"\n    df[\"formatter\"] = f\"bbh-{subset}\"\n    df[\"subset\"] = f\"bbh-{subset}\"\n    df[\"split\"] = \"test\"\n    df = df[[\"question\", \"variables\", \"target\", \"dataset\", \"formatter\", \"subset\", \"split\"]]\n    return df\n\n\ndf_bbh = [\n    load_bbh_subset(subset)\n    for subset in ['boolean_expressions', 'causal_judgement', 'date_understanding',\n                   'disambiguation_qa', 'dyck_languages', 'formal_fallacies',\n                   'geometric_shapes', 'hyperbaton', 'logical_deduction_five_objects',\n                   'logical_deduction_seven_objects', 'logical_deduction_three_objects',\n                   'movie_recommendation', 'multistep_arithmetic_two',\n                   'navigate', 'object_counting', 'penguins_in_a_table',\n                   'reasoning_about_colored_objects', 'ruin_names', 'salient_translation_error_detection',\n                   'snarks', 'sports_understanding', 'temporal_sequences',\n                   'tracking_shuffled_objects_five_objects', 'tracking_shuffled_objects_seven_objects',\n                   'tracking_shuffled_objects_three_objects', 'web_of_lies', 'word_sorting']\n]\ndf_bbh = pd.concat(df_bbh).reset_index(drop=True)\ndf_bbh.head()\n\nLOAD BBH boolean_expressions SUBSET\nLOAD BBH causal_judgement SUBSET\nLOAD BBH date_understanding SUBSET\nLOAD BBH disambiguation_qa SUBSET\nLOAD BBH dyck_languages SUBSET\nLOAD BBH formal_fallacies SUBSET\nLOAD BBH geometric_shapes SUBSET\nLOAD BBH hyperbaton SUBSET\nLOAD BBH logical_deduction_five_objects SUBSET\nLOAD BBH logical_deduction_seven_objects SUBSET\nLOAD BBH logical_deduction_three_objects SUBSET\nLOAD BBH movie_recommendation SUBSET\nLOAD BBH multistep_arithmetic_two SUBSET\nLOAD BBH navigate SUBSET\nLOAD BBH object_counting SUBSET\nLOAD BBH penguins_in_a_table SUBSET\nLOAD BBH reasoning_about_colored_objects SUBSET\nLOAD BBH ruin_names SUBSET\nLOAD BBH salient_translation_error_detection SUBSET\nLOAD BBH snarks SUBSET\nLOAD BBH sports_understanding SUBSET\nLOAD BBH temporal_sequences SUBSET\nLOAD BBH tracking_shuffled_objects_five_objects SUBSET\nLOAD BBH tracking_shuffled_objects_seven_objects SUBSET\nLOAD BBH tracking_shuffled_objects_three_objects SUBSET\nLOAD BBH web_of_lies SUBSET\nLOAD BBH word_sorting SUBSET\n\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nnot ( True ) and ( True ) is\n{}\nFalse\nbbh\nbbh-boolean_expressions\nbbh-boolean_expressions\ntest\n\n\n1\nTrue and not not ( not False ) is\n{}\nTrue\nbbh\nbbh-boolean_expressions\nbbh-boolean_expressions\ntest\n\n\n2\nnot True or False or ( False ) is\n{}\nFalse\nbbh\nbbh-boolean_expressions\nbbh-boolean_expressions\ntest\n\n\n3\nFalse or not ( True ) and False is\n{}\nFalse\nbbh\nbbh-boolean_expressions\nbbh-boolean_expressions\ntest\n\n\n4\nTrue or not False and True and False is\n{}\nTrue\nbbh\nbbh-boolean_expressions\nbbh-boolean_expressions\ntest"
  },
  {
    "objectID": "prepare_datasets.html#humaneval",
    "href": "prepare_datasets.html#humaneval",
    "title": "Preparing datasets",
    "section": "HumanEval",
    "text": "HumanEval\n\ndataset_humaneval = load_dataset(\"openai_humaneval\")\ndataset_humaneval\n\nDatasetDict({\n    test: Dataset({\n        features: ['task_id', 'prompt', 'canonical_solution', 'test', 'entry_point'],\n        num_rows: 164\n    })\n})\n\n\n\ndf_humaneval = pd.DataFrame(dataset_humaneval[\"test\"])\ndf_humaneval[\"question\"] = df_humaneval[\"prompt\"]\ndf_humaneval[\"target\"] = df_humaneval[\"canonical_solution\"]\ndf_humaneval[\"variables\"] = df_humaneval[\"test\"].apply(lambda val: {\"test\": val})\\\n    .apply(json.dumps)\ndf_humaneval[\"dataset\"] = \"humaneval\"\ndf_humaneval[\"formatter\"] = \"humaneval\"\ndf_humaneval[\"subset\"] = \"main\"\ndf_humaneval[\"split\"] = \"test\"\ndf_humaneval = df_humaneval[[\"question\", \"variables\", \"target\", \"dataset\", \"formatter\", \"subset\", \"split\"]]\ndf_humaneval.head()\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nfrom typing import List\\n\\n\\ndef has_close_ele...\n{\"test\": \"\\n\\nMETADATA = {\\n 'author': 'jt'...\nfor idx, elem in enumerate(numbers):\\n ...\nhumaneval\nhumaneval\nmain\ntest\n\n\n1\nfrom typing import List\\n\\n\\ndef separate_pare...\n{\"test\": \"\\n\\nMETADATA = {\\n 'author': 'jt'...\nresult = []\\n current_string = []\\n ...\nhumaneval\nhumaneval\nmain\ntest\n\n\n2\n\\n\\ndef truncate_number(number: float) -&gt; floa...\n{\"test\": \"\\n\\nMETADATA = {\\n 'author': 'jt'...\nreturn number % 1.0\\n\nhumaneval\nhumaneval\nmain\ntest\n\n\n3\nfrom typing import List\\n\\n\\ndef below_zero(op...\n{\"test\": \"\\n\\nMETADATA = {\\n 'author': 'jt'...\nbalance = 0\\n\\n for op in operations:\\n...\nhumaneval\nhumaneval\nmain\ntest\n\n\n4\nfrom typing import List\\n\\n\\ndef mean_absolute...\n{\"test\": \"\\n\\nMETADATA = {\\n 'author': 'jt'...\nmean = sum(numbers) / len(numbers)\\n re...\nhumaneval\nhumaneval\nmain\ntest"
  },
  {
    "objectID": "prepare_datasets.html#join",
    "href": "prepare_datasets.html#join",
    "title": "Preparing datasets",
    "section": "Join",
    "text": "Join\n\ndf = pd.concat([df_mmlu, df_gsm8k, df_bbh, df_humaneval])\\\n    .reset_index(drop=True)\ndf.head()\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\ndataset\nformatter\nsubset\nsplit\n\n\n\n\n0\nThis question refers to the following informat...\n{\"A\": \"The ideas of personal liberty and natio...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n1\nThis question refers to the following informat...\n{\"A\": \"Capitalist\", \"B\": \"Scientific\", \"C\": \"C...\nC\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n2\nThis question refers to the following informat...\n{\"A\": \"They served as a catalyst for the growt...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n3\nThis question refers to the following informat...\n{\"A\": \"give the English king a new position of...\nD\nmmlu\nmmlu\nmmlu-high_school_european_history\ntrain\n\n\n4\nThis question refers to the following informat...\n{\"A\": \"In ancient Rome, religious worship was ...\nA\nmmlu\nmmlu\nmmlu-high_school_european_history\ntest"
  },
  {
    "objectID": "prepare_datasets.html#rearrange-splits",
    "href": "prepare_datasets.html#rearrange-splits",
    "title": "Preparing datasets",
    "section": "Rearrange splits",
    "text": "Rearrange splits\nSome datasets have only test splits. That’s fine but we want to do some train-validation-test processing.\n\nREARRANGE_RANDOM_STATE = 42\n\n\ndf.groupby([\"dataset\", \"split\"]).count()\n\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\nformatter\nsubset\n\n\ndataset\nsplit\n\n\n\n\n\n\n\n\n\nbbh\ntest\n6511\n6511\n6511\n6511\n6511\n\n\ngsm8k\ntest\n1319\n1319\n1319\n1319\n1319\n\n\ntrain\n7473\n7473\n7473\n7473\n7473\n\n\nhumaneval\ntest\n164\n164\n164\n164\n164\n\n\nmmlu\ntest\n13985\n13985\n13985\n13985\n13985\n\n\ntrain\n228\n228\n228\n228\n228\n\n\nvalidation\n1474\n1474\n1474\n1474\n1474\n\n\n\n\n\n\n\n\ndef rearrange_split(df, dataset, rearranging, random_state):\n    masks = {}\n    counts = {}\n    for source_split in rearranging:\n        masks[source_split] = (df[\"dataset\"] == dataset) & (df[\"split\"] == source_split)\n        counts[source_split] = masks[source_split].sum()\n    random.seed(random_state)\n    for source_split, dst_splits in rearranging.items():\n        source_mask = masks[source_split]\n        source_count = counts[source_split]\n        \n        new_splits = dict(dst_splits)\n        new_splits[source_split] = 1.0 - sum(dst_splits.values())\n        \n        new_split_names = sorted(new_splits.keys())\n        new_split_probas = [new_splits[name] for name in new_split_names]\n        \n        new_split_choices = [\n            random.choices(\n                new_split_names,\n                weights=new_split_probas,\n                k=1\n            )[0]\n            for _ in range(source_count)\n        ]\n        \n        df.loc[source_mask, \"split\"] = new_split_choices\n    \n    return df\n\n\ndf = rearrange_split(df, \"bbh\", {\"test\": {\"train\": 0.33, \"validation\": 0.33}}, REARRANGE_RANDOM_STATE)\ndf = rearrange_split(df, \"gsm8k\", {\"train\": {\"validation\": 0.5}}, REARRANGE_RANDOM_STATE)\ndf = rearrange_split(df, \"humaneval\", {\"test\": {\"train\": 0.33, \"validation\": 0.33}}, REARRANGE_RANDOM_STATE)\n\n\ndf.groupby([\"dataset\", \"split\"]).count()\n\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\nformatter\nsubset\n\n\ndataset\nsplit\n\n\n\n\n\n\n\n\n\nbbh\ntest\n2204\n2204\n2204\n2204\n2204\n\n\ntrain\n2147\n2147\n2147\n2147\n2147\n\n\nvalidation\n2160\n2160\n2160\n2160\n2160\n\n\ngsm8k\ntest\n1319\n1319\n1319\n1319\n1319\n\n\ntrain\n3725\n3725\n3725\n3725\n3725\n\n\nvalidation\n3748\n3748\n3748\n3748\n3748\n\n\nhumaneval\ntest\n65\n65\n65\n65\n65\n\n\ntrain\n51\n51\n51\n51\n51\n\n\nvalidation\n48\n48\n48\n48\n48\n\n\nmmlu\ntest\n13985\n13985\n13985\n13985\n13985\n\n\ntrain\n228\n228\n228\n228\n228\n\n\nvalidation\n1474\n1474\n1474\n1474\n1474"
  },
  {
    "objectID": "prepare_datasets.html#subsampling",
    "href": "prepare_datasets.html#subsampling",
    "title": "Preparing datasets",
    "section": "Subsampling",
    "text": "Subsampling\nToo much data for such a small experiment, so I will limit it to subsample of original for some sets\n\nSUBSAMPLE_RANDOM_STATE = 42\n\n\ndef subsample(df, dataset, split, keep_count, random_state):\n    mask_other_datasets = df[\"dataset\"] != dataset\n    mask_same_dataset = ~mask_other_datasets\n    mask_other_splits = mask_same_dataset & (df[\"split\"] != split)\n    mask_same_split = mask_same_dataset & (df[\"split\"] == split)\n    mask_keep = mask_other_datasets | mask_other_splits\n    mask_remove = mask_same_split\n    \n    _, indices_keep = train_test_split(\n        list(df.loc[mask_remove].index),\n        stratify=list(df.loc[mask_remove, \"subset\"]),\n        random_state=random_state,\n        test_size=keep_count,\n    )\n    mask_remove[indices_keep] = False\n    \n    mask_keep = mask_keep | (~mask_remove)\n    \n    return df.loc[mask_keep]\n\n\ndf = subsample(df, \"gsm8k\", \"train\", 100, SUBSAMPLE_RANDOM_STATE)\ndf = subsample(df, \"gsm8k\", \"validation\", 100, SUBSAMPLE_RANDOM_STATE)\ndf = subsample(df, \"gsm8k\", \"test\", 100, SUBSAMPLE_RANDOM_STATE)\n\n\ndf = subsample(df, \"bbh\", \"train\", 100, SUBSAMPLE_RANDOM_STATE)\ndf = subsample(df, \"bbh\", \"validation\", 100, SUBSAMPLE_RANDOM_STATE)\ndf = subsample(df, \"bbh\", \"test\", 100, SUBSAMPLE_RANDOM_STATE)\n\n\ndf = subsample(df, \"mmlu\", \"test\", 300, SUBSAMPLE_RANDOM_STATE)\ndf = subsample(df, \"mmlu\", \"validation\", 300, SUBSAMPLE_RANDOM_STATE)\n\n\ndf.groupby([\"dataset\", \"split\"]).count()\n\n\n\n\n\n\n\n\n\nquestion\nvariables\ntarget\nformatter\nsubset\n\n\ndataset\nsplit\n\n\n\n\n\n\n\n\n\nbbh\ntest\n100\n100\n100\n100\n100\n\n\ntrain\n100\n100\n100\n100\n100\n\n\nvalidation\n100\n100\n100\n100\n100\n\n\ngsm8k\ntest\n100\n100\n100\n100\n100\n\n\ntrain\n100\n100\n100\n100\n100\n\n\nvalidation\n100\n100\n100\n100\n100\n\n\nhumaneval\ntest\n65\n65\n65\n65\n65\n\n\ntrain\n51\n51\n51\n51\n51\n\n\nvalidation\n48\n48\n48\n48\n48\n\n\nmmlu\ntest\n300\n300\n300\n300\n300\n\n\ntrain\n228\n228\n228\n228\n228\n\n\nvalidation\n300\n300\n300\n300\n300"
  },
  {
    "objectID": "prepare_datasets.html#saving-dataset-and-llm-prompt-templates",
    "href": "prepare_datasets.html#saving-dataset-and-llm-prompt-templates",
    "title": "Preparing datasets",
    "section": "Saving dataset and LLM prompt templates",
    "text": "Saving dataset and LLM prompt templates\n\nfor subset, index in df.groupby(\"subset\").apply(lambda df: df.sample(1, random_state=42).index[0]).to_dict().items():\n    print(subset)\n    print(df.loc[index])\n    print(\"-\" * 80)\n\nbbh-boolean_expressions\nquestion     False and not ( not not False ) is\nvariables                                    {}\ntarget                                    False\ndataset                                     bbh\nformatter               bbh-boolean_expressions\nsubset                  bbh-boolean_expressions\nsplit                                     train\nName: 24705, dtype: object\n--------------------------------------------------------------------------------\nbbh-causal_judgement\nquestion     How would a typical person answer each of the ...\nvariables                                                   {}\ntarget                                                      No\ndataset                                                    bbh\nformatter                                 bbh-causal_judgement\nsubset                                    bbh-causal_judgement\nsplit                                               validation\nName: 24801, dtype: object\n--------------------------------------------------------------------------------\nbbh-date_understanding\nquestion     Tomorrow is 11/12/2019. What is the date 10 da...\nvariables                                                   {}\ntarget                                                     (B)\ndataset                                                    bbh\nformatter                               bbh-date_understanding\nsubset                                  bbh-date_understanding\nsplit                                                     test\nName: 25142, dtype: object\n--------------------------------------------------------------------------------\nbbh-disambiguation_qa\nquestion     In the following sentences, explain the antece...\nvariables                                                   {}\ntarget                                                     (A)\ndataset                                                    bbh\nformatter                                bbh-disambiguation_qa\nsubset                                   bbh-disambiguation_qa\nsplit                                               validation\nName: 25219, dtype: object\n--------------------------------------------------------------------------------\nbbh-dyck_languages\nquestion     Complete the rest of the sequence, making sure...\nvariables                                                   {}\ntarget                                                     ) }\ndataset                                                    bbh\nformatter                                   bbh-dyck_languages\nsubset                                      bbh-dyck_languages\nsplit                                                    train\nName: 25658, dtype: object\n--------------------------------------------------------------------------------\nbbh-formal_fallacies\nquestion     \"Is Titanium oxide an ingredient of my washing...\nvariables                                                   {}\ntarget                                                   valid\ndataset                                                    bbh\nformatter                                 bbh-formal_fallacies\nsubset                                    bbh-formal_fallacies\nsplit                                                     test\nName: 25852, dtype: object\n--------------------------------------------------------------------------------\nbbh-geometric_shapes\nquestion     This SVG path element &lt;path d=\"M 43.79,3.46 L ...\nvariables                                                   {}\ntarget                                                     (J)\ndataset                                                    bbh\nformatter                                 bbh-geometric_shapes\nsubset                                    bbh-geometric_shapes\nsplit                                               validation\nName: 26008, dtype: object\n--------------------------------------------------------------------------------\nbbh-hyperbaton\nquestion     Which sentence has the correct adjective order...\nvariables                                                   {}\ntarget                                                     (A)\ndataset                                                    bbh\nformatter                                       bbh-hyperbaton\nsubset                                          bbh-hyperbaton\nsplit                                                    train\nName: 26372, dtype: object\n--------------------------------------------------------------------------------\nbbh-logical_deduction_five_objects\nquestion     The following paragraphs each describe a set o...\nvariables                                                   {}\ntarget                                                     (D)\ndataset                                                    bbh\nformatter                   bbh-logical_deduction_five_objects\nsubset                      bbh-logical_deduction_five_objects\nsplit                                                    train\nName: 26596, dtype: object\n--------------------------------------------------------------------------------\nbbh-logical_deduction_seven_objects\nquestion     The following paragraphs each describe a set o...\nvariables                                                   {}\ntarget                                                     (E)\ndataset                                                    bbh\nformatter                  bbh-logical_deduction_seven_objects\nsubset                     bbh-logical_deduction_seven_objects\nsplit                                               validation\nName: 26806, dtype: object\n--------------------------------------------------------------------------------\nbbh-logical_deduction_three_objects\nquestion     The following paragraphs each describe a set o...\nvariables                                                   {}\ntarget                                                     (A)\ndataset                                                    bbh\nformatter                  bbh-logical_deduction_three_objects\nsubset                     bbh-logical_deduction_three_objects\nsplit                                               validation\nName: 27063, dtype: object\n--------------------------------------------------------------------------------\nbbh-movie_recommendation\nquestion     Find a movie similar to American Beauty, Back ...\nvariables                                                   {}\ntarget                                                     (D)\ndataset                                                    bbh\nformatter                             bbh-movie_recommendation\nsubset                                bbh-movie_recommendation\nsplit                                                     test\nName: 27279, dtype: object\n--------------------------------------------------------------------------------\nbbh-multistep_arithmetic_two\nquestion     ((8 + 1 + 6 + 6) - (7 - -7 - 9 - -8)) =\nvariables                                         {}\ntarget                                             8\ndataset                                          bbh\nformatter               bbh-multistep_arithmetic_two\nsubset                  bbh-multistep_arithmetic_two\nsplit                                          train\nName: 27528, dtype: object\n--------------------------------------------------------------------------------\nbbh-navigate\nquestion     If you follow these instructions, do you retur...\nvariables                                                   {}\ntarget                                                      No\ndataset                                                    bbh\nformatter                                         bbh-navigate\nsubset                                            bbh-navigate\nsplit                                               validation\nName: 27815, dtype: object\n--------------------------------------------------------------------------------\nbbh-object_counting\nquestion     I have a trumpet, a piano, a flute, a snake, t...\nvariables                                                   {}\ntarget                                                      10\ndataset                                                    bbh\nformatter                                  bbh-object_counting\nsubset                                     bbh-object_counting\nsplit                                               validation\nName: 28072, dtype: object\n--------------------------------------------------------------------------------\nbbh-penguins_in_a_table\nquestion     Here is a table where the first line is a head...\nvariables                                                   {}\ntarget                                                     (C)\ndataset                                                    bbh\nformatter                              bbh-penguins_in_a_table\nsubset                                 bbh-penguins_in_a_table\nsplit                                               validation\nName: 28194, dtype: object\n--------------------------------------------------------------------------------\nbbh-reasoning_about_colored_objects\nquestion     On the table, there is a black pen, a brown br...\nvariables                                                   {}\ntarget                                                     (D)\ndataset                                                    bbh\nformatter                  bbh-reasoning_about_colored_objects\nsubset                     bbh-reasoning_about_colored_objects\nsplit                                                    train\nName: 28530, dtype: object\n--------------------------------------------------------------------------------\nbbh-ruin_names\nquestion     Which of the following is a humorous edit of t...\nvariables                                                   {}\ntarget                                                     (D)\ndataset                                                    bbh\nformatter                                       bbh-ruin_names\nsubset                                          bbh-ruin_names\nsplit                                               validation\nName: 28722, dtype: object\n--------------------------------------------------------------------------------\nbbh-salient_translation_error_detection\nquestion     The following translations from German to Engl...\nvariables                                                   {}\ntarget                                                     (F)\ndataset                                                    bbh\nformatter              bbh-salient_translation_error_detection\nsubset                 bbh-salient_translation_error_detection\nsplit                                                    train\nName: 29019, dtype: object\n--------------------------------------------------------------------------------\nbbh-snarks\nquestion     Which statement is sarcastic?\\nOptions:\\n(A) I...\nvariables                                                   {}\ntarget                                                     (B)\ndataset                                                    bbh\nformatter                                           bbh-snarks\nsubset                                              bbh-snarks\nsplit                                                    train\nName: 29123, dtype: object\n--------------------------------------------------------------------------------\nbbh-sports_understanding\nquestion     Is the following sentence plausible? \"Allen Ro...\nvariables                                                   {}\ntarget                                                     yes\ndataset                                                    bbh\nformatter                             bbh-sports_understanding\nsubset                                bbh-sports_understanding\nsplit                                               validation\nName: 29466, dtype: object\n--------------------------------------------------------------------------------\nbbh-temporal_sequences\nquestion     Today, Ashley went to the orchestra hall. Betw...\nvariables                                                   {}\ntarget                                                     (A)\ndataset                                                    bbh\nformatter                               bbh-temporal_sequences\nsubset                                  bbh-temporal_sequences\nsplit                                                     test\nName: 29727, dtype: object\n--------------------------------------------------------------------------------\nbbh-tracking_shuffled_objects_five_objects\nquestion     Alice, Bob, Claire, Dave, and Eve are on the s...\nvariables                                                   {}\ntarget                                                     (E)\ndataset                                                    bbh\nformatter           bbh-tracking_shuffled_objects_five_objects\nsubset              bbh-tracking_shuffled_objects_five_objects\nsplit                                                    train\nName: 29860, dtype: object\n--------------------------------------------------------------------------------\nbbh-tracking_shuffled_objects_seven_objects\nquestion     Alice, Bob, Claire, Dave, Eve, Fred, and Gertr...\nvariables                                                   {}\ntarget                                                     (C)\ndataset                                                    bbh\nformatter          bbh-tracking_shuffled_objects_seven_objects\nsubset             bbh-tracking_shuffled_objects_seven_objects\nsplit                                               validation\nName: 30198, dtype: object\n--------------------------------------------------------------------------------\nbbh-tracking_shuffled_objects_three_objects\nquestion     Alice, Bob, and Claire are friends and avid re...\nvariables                                                   {}\ntarget                                                     (C)\ndataset                                                    bbh\nformatter          bbh-tracking_shuffled_objects_three_objects\nsubset             bbh-tracking_shuffled_objects_three_objects\nsplit                                               validation\nName: 30411, dtype: object\n--------------------------------------------------------------------------------\nbbh-web_of_lies\nquestion     Question: Shaunda tells the truth. Delbert say...\nvariables                                                   {}\ntarget                                                      No\ndataset                                                    bbh\nformatter                                      bbh-web_of_lies\nsubset                                         bbh-web_of_lies\nsplit                                               validation\nName: 30697, dtype: object\n--------------------------------------------------------------------------------\nbbh-word_sorting\nquestion     Sort the following words alphabetically: List:...\nvariables                                                   {}\ntarget                                           muddy nascent\ndataset                                                    bbh\nformatter                                     bbh-word_sorting\nsubset                                        bbh-word_sorting\nsplit                                                    train\nName: 30951, dtype: object\n--------------------------------------------------------------------------------\ngsm8k\nquestion     Raymond and Samantha are cousins. Raymond was ...\nvariables    {\"chain_of_thoughts\": \"When Raymond's son was ...\ntarget                                                      14\ndataset                                                  gsm8k\nformatter                                                gsm8k\nsubset                                                   gsm8k\nsplit                                                     test\nName: 23181, dtype: object\n--------------------------------------------------------------------------------\nmain\nquestion     \\ndef can_arrange(arr):\\n    \"\"\"Create a funct...\nvariables    {\"test\": \"def check(candidate):\\n\\n    # Check...\ntarget           ind=-1\\n    i=1\\n    while i&lt;len(arr):\\n  ...\ndataset                                              humaneval\nformatter                                            humaneval\nsubset                                                    main\nsplit                                                    train\nName: 31125, dtype: object\n--------------------------------------------------------------------------------\nmmlu-abstract_algebra\nquestion     Statement 1 | Every element of a group generat...\nvariables    {\"A\": \"True, True\", \"B\": \"False, False\", \"C\": ...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-abstract_algebra\nsplit                                                    train\nName: 2408, dtype: object\n--------------------------------------------------------------------------------\nmmlu-anatomy\nquestion     Which one of the following is brought about by...\nvariables    {\"A\": \"Contraction of bronchial smooth muscle....\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                            mmlu-anatomy\nsplit                                               validation\nName: 5654, dtype: object\n--------------------------------------------------------------------------------\nmmlu-astronomy\nquestion     What dangers are currently faced by each Mars ...\nvariables    {\"A\": \"Opportunity may not be able to drive ou...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                          mmlu-astronomy\nsplit                                               validation\nName: 15516, dtype: object\n--------------------------------------------------------------------------------\nmmlu-business_ethics\nquestion     To ensure the independence of the non-executiv...\nvariables    {\"A\": \"Outside, Limited, Independently\", \"B\": ...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-business_ethics\nsplit                                                    train\nName: 186, dtype: object\n--------------------------------------------------------------------------------\nmmlu-clinical_knowledge\nquestion     What is the difference between a male and a fe...\nvariables    {\"A\": \"Male and female catheters are different...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                 mmlu-clinical_knowledge\nsplit                                                    train\nName: 298, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_biology\nquestion     Which of the following traits do prokaryotes a...\nvariables    {\"A\": \"A single chromosome carries the entire ...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-college_biology\nsplit                                               validation\nName: 15685, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_chemistry\nquestion     A 0.217 g sample of HgO (molar mass = 217 g) r...\nvariables    {\"A\": \"1.0 mL\", \"B\": \"10 mL\", \"C\": \"20 mL\", \"D...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                  mmlu-college_chemistry\nsplit                                                    train\nName: 6216, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_computer_science\nquestion     The Singleton design pattern is used to guaran...\nvariables    {\"A\": \"I only\", \"B\": \"II only\", \"C\": \"III only...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                           mmlu-college_computer_science\nsplit                                                    train\nName: 1951, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_mathematics\nquestion     Let A be a real 2x2 matrix. Which of the follo...\nvariables    {\"A\": \"I only\", \"B\": \"II only\", \"C\": \"III only...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                mmlu-college_mathematics\nsplit                                                    train\nName: 7401, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_medicine\nquestion     Which of the following would be the most accur...\nvariables    {\"A\": \"An intrinsic desire to know the truth.\"...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-college_medicine\nsplit                                               validation\nName: 5983, dtype: object\n--------------------------------------------------------------------------------\nmmlu-college_physics\nquestion     One end of a Nichrome wire of length 2L and cr...\nvariables    {\"A\": \"2.4 V\", \"B\": \"3.3 V\", \"C\": \"4.5 V\", \"D\"...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-college_physics\nsplit                                                    train\nName: 12496, dtype: object\n--------------------------------------------------------------------------------\nmmlu-computer_security\nquestion                              What is ethical hacking?\nvariables    {\"A\": \"\\\"Hacking\\\" ethics so they justify unin...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                  mmlu-computer_security\nsplit                                                    train\nName: 13697, dtype: object\n--------------------------------------------------------------------------------\nmmlu-conceptual_physics\nquestion     A magnetic force can act on an electron even w...\nvariables    {\"A\": \"is at rest\", \"B\": \"moves parallel to ma...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                 mmlu-conceptual_physics\nsplit                                               validation\nName: 9294, dtype: object\n--------------------------------------------------------------------------------\nmmlu-econometrics\nquestion     Suppose that a test statistic has associated w...\nvariables    {\"A\": \"(ii) and (iv) only\", \"B\": \"(i) and (iii...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                       mmlu-econometrics\nsplit                                                    train\nName: 1823, dtype: object\n--------------------------------------------------------------------------------\nmmlu-electrical_engineering\nquestion     When checked with an ohm meter an open resisto...\nvariables    {\"A\": \"high but within tolerance.\", \"B\": \"low ...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                             mmlu-electrical_engineering\nsplit                                               validation\nName: 15341, dtype: object\n--------------------------------------------------------------------------------\nmmlu-elementary_mathematics\nquestion     Olivia used the rule \"Add 11\" to create the nu...\nvariables    {\"A\": \"The 10th number in the pattern will be ...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                             mmlu-elementary_mathematics\nsplit                                                    train\nName: 6731, dtype: object\n--------------------------------------------------------------------------------\nmmlu-formal_logic\nquestion      Use indirect truth tables to determine whethe...\nvariables    {\"A\": \"Inconsistent\", \"B\": \"Consistent. Consis...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                       mmlu-formal_logic\nsplit                                               validation\nName: 8256, dtype: object\n--------------------------------------------------------------------------------\nmmlu-global_facts\nquestion     As of 2015, since 1990 forests have ____ in Eu...\nvariables    {\"A\": \"increased, increased\", \"B\": \"increased,...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                       mmlu-global_facts\nsplit                                                    train\nName: 3829, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_biology\nquestion     A mutation in a bacterial enzyme changed a pre...\nvariables    {\"A\": \"By changing the enzyme\\u2019s pH optimu...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                mmlu-high_school_biology\nsplit                                                    train\nName: 2063, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_chemistry\nquestion     4NH3(g) + 5O2(g) → 4NO(g) + 6H2O(g) This react...\nvariables    {\"A\": \"The catalyst increases the overall freq...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                              mmlu-high_school_chemistry\nsplit                                               validation\nName: 10408, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_computer_science\nquestion       What is the output of \"abc\"[::-1] in Python 3?\nvariables    {\"A\": \"Error\", \"B\": \"abc\", \"C\": \"cba\", \"D\": \"c\"}\ntarget                                                      C\ndataset                                                  mmlu\nformatter                                                mmlu\nsubset                      mmlu-high_school_computer_science\nsplit                                                   train\nName: 8941, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_european_history\nquestion     This question refers to the following informat...\nvariables    {\"A\": \"Unify Italy with his brother as king\", ...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                       mmlu-high_school_european_history\nsplit                                               validation\nName: 172, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_geography\nquestion     Which of the following is NOT usually a possib...\nvariables    {\"A\": \"Educational opportunities\", \"B\": \"Envir...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                              mmlu-high_school_geography\nsplit                                               validation\nName: 6718, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_government_and_politics\nquestion     Which of the following court decisions did NOT...\nvariables    {\"A\": \"Roe v. Wade\", \"B\": \"New York Times v. U...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                mmlu-high_school_government_and_politics\nsplit                                               validation\nName: 6205, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_macroeconomics\nquestion              The short-run Phillips curve indicates a\nvariables    {\"A\": \"direct relation between unemployment an...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                         mmlu-high_school_macroeconomics\nsplit                                                    train\nName: 13261, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_mathematics\nquestion     Five thousand dollars compounded annually at a...\nvariables           {\"A\": \"12\", \"B\": \"1\", \"C\": \"30\", \"D\": \"5\"}\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                            mmlu-high_school_mathematics\nsplit                                                    train\nName: 8639, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_microeconomics\nquestion     If, as the price of a particular good increase...\nvariables    {\"A\": \"Diminishing marginal productivity.\", \"B...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                         mmlu-high_school_microeconomics\nsplit                                               validation\nName: 1799, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_physics\nquestion     An object initially at rest experiences a time...\nvariables    {\"A\": \"9 m\", \"B\": \"12 m\", \"C\": \"18 m\", \"D\": \"2...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                mmlu-high_school_physics\nsplit                                               validation\nName: 1093, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_psychology\nquestion     Because Jake, the team's starting, star center...\nvariables    {\"A\": \"positive punishment.\", \"B\": \"negative r...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                             mmlu-high_school_psychology\nsplit                                                     test\nName: 7812, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_statistics\nquestion     A skeptic decides to conduct an experiment in ...\nvariables         {\"A\": \"51\", \"B\": \"59\", \"C\": \"75\", \"D\": \"95\"}\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                             mmlu-high_school_statistics\nsplit                                               validation\nName: 8485, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_us_history\nquestion     This question refers to the following informat...\nvariables    {\"A\": \"The \\\"New Look\\\" foreign policy.\", \"B\":...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                             mmlu-high_school_us_history\nsplit                                               validation\nName: 927, dtype: object\n--------------------------------------------------------------------------------\nmmlu-high_school_world_history\nquestion     This question refers to the following informat...\nvariables    {\"A\": \"The militarism of early Mesopotamian po...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                          mmlu-high_school_world_history\nsplit                                               validation\nName: 1347, dtype: object\n--------------------------------------------------------------------------------\nmmlu-human_aging\nquestion     The strongest research technique for determini...\nvariables    {\"A\": \"Siblings and parents\", \"B\": \"Identical ...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                        mmlu-human_aging\nsplit                                               validation\nName: 7382, dtype: object\n--------------------------------------------------------------------------------\nmmlu-human_sexuality\nquestion     The feedback loop in women which regulates the...\nvariables    {\"A\": \"introitus\", \"B\": \"progesterone\", \"C\": \"...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-human_sexuality\nsplit                                               validation\nName: 5801, dtype: object\n--------------------------------------------------------------------------------\nmmlu-international_law\nquestion     Can armed violence perpetrated by non-State ac...\nvariables    {\"A\": \"The conduct of non-State actors can nev...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                  mmlu-international_law\nsplit                                               validation\nName: 8630, dtype: object\n--------------------------------------------------------------------------------\nmmlu-jurisprudence\nquestion     Which word best summarizes Weber's explanation...\nvariables    {\"A\": \"Authority.\", \"B\": \"Charisma.\", \"C\": \"Co...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                      mmlu-jurisprudence\nsplit                                                    train\nName: 12611, dtype: object\n--------------------------------------------------------------------------------\nmmlu-logical_fallacies\nquestion     Evading burden of proof is another name for th...\nvariables    {\"A\": \"Extension\", \"B\": \"Appeal to ignorance\",...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                  mmlu-logical_fallacies\nsplit                                                     test\nName: 6399, dtype: object\n--------------------------------------------------------------------------------\nmmlu-machine_learning\nquestion     You are reviewing papers for the World’s Fanci...\nvariables    {\"A\": \"My method achieves a training error low...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-machine_learning\nsplit                                                    train\nName: 3941, dtype: object\n--------------------------------------------------------------------------------\nmmlu-management\nquestion      Which element of the cultural web forms regalia?\nvariables    {\"A\": \"Symbols\", \"B\": \"Rituals and routines\", ...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                         mmlu-management\nsplit                                                    train\nName: 12380, dtype: object\n--------------------------------------------------------------------------------\nmmlu-marketing\nquestion     Which of the following terms best fits the act...\nvariables    {\"A\": \"Making products available.\", \"B\": \"Conv...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                          mmlu-marketing\nsplit                                               validation\nName: 10652, dtype: object\n--------------------------------------------------------------------------------\nmmlu-medical_genetics\nquestion                            A gene showing codominance\nvariables    {\"A\": \"has both alleles independently expresse...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-medical_genetics\nsplit                                                    train\nName: 595, dtype: object\n--------------------------------------------------------------------------------\nmmlu-miscellaneous\nquestion     What mathematical term is used to describe the...\nvariables    {\"A\": \"median\", \"B\": \"mode\", \"C\": \"majority\", ...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                      mmlu-miscellaneous\nsplit                                               validation\nName: 10154, dtype: object\n--------------------------------------------------------------------------------\nmmlu-moral_disputes\nquestion                    A fertilized ovum is also known as\nvariables    {\"A\": \"a zygote.\", \"B\": \"an embryo.\", \"C\": \"a ...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                     mmlu-moral_disputes\nsplit                                                    train\nName: 14806, dtype: object\n--------------------------------------------------------------------------------\nmmlu-moral_scenarios\nquestion     For which of these two scenarios does the main...\nvariables    {\"A\": \"Wrong, Wrong\", \"B\": \"Wrong, Not wrong\",...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-moral_scenarios\nsplit                                               validation\nName: 14785, dtype: object\n--------------------------------------------------------------------------------\nmmlu-nutrition\nquestion     Which of the following statements is correct (...\nvariables    {\"A\": \"Consumers with phenylketonuria must avo...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                          mmlu-nutrition\nsplit                                                    train\nName: 3487, dtype: object\n--------------------------------------------------------------------------------\nmmlu-philosophy\nquestion     According to Moore’s “ideal utilitarianism,” t...\nvariables    {\"A\": \"pleasure.\", \"B\": \"happiness.\", \"C\": \"go...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                         mmlu-philosophy\nsplit                                                    train\nName: 2835, dtype: object\n--------------------------------------------------------------------------------\nmmlu-prehistory\nquestion     According to Timothy Pauketat, the evidence fo...\nvariables    {\"A\": \"a center of Mississippian civilization ...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                         mmlu-prehistory\nsplit                                                    train\nName: 5146, dtype: object\n--------------------------------------------------------------------------------\nmmlu-professional_accounting\nquestion     One hundred years ago, your great-great-grandm...\nvariables    {\"A\": \"$13,000\", \"B\": \"$600\", \"C\": \"$15,000\", ...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                            mmlu-professional_accounting\nsplit                                                    train\nName: 2520, dtype: object\n--------------------------------------------------------------------------------\nmmlu-professional_law\nquestion     An inventor developed a prototype of an automo...\nvariables    {\"A\": \"the brother, because the rights of an a...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-professional_law\nsplit                                                     test\nName: 11509, dtype: object\n--------------------------------------------------------------------------------\nmmlu-professional_medicine\nquestion     A 36-year-old male presents to the office with...\nvariables    {\"A\": \"left-on-left sacral torsion\", \"B\": \"lef...\ntarget                                                       D\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                              mmlu-professional_medicine\nsplit                                                    train\nName: 3182, dtype: object\n--------------------------------------------------------------------------------\nmmlu-professional_psychology\nquestion     A motivational theory predicting thar an incre...\nvariables    {\"A\": \"goal-setting theory\", \"B\": \"need-achiev...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                            mmlu-professional_psychology\nsplit                                               validation\nName: 5113, dtype: object\n--------------------------------------------------------------------------------\nmmlu-public_relations\nquestion     Which of these statements is true of the Vatic...\nvariables    {\"A\": \"There was a coordinated media response....\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-public_relations\nsplit                                                    train\nName: 4340, dtype: object\n--------------------------------------------------------------------------------\nmmlu-security_studies\nquestion     What is the relationship between historical ma...\nvariables    {\"A\": \"As a philosophical approach, HM focuses...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                   mmlu-security_studies\nsplit                                               validation\nName: 4319, dtype: object\n--------------------------------------------------------------------------------\nmmlu-sociology\nquestion     Wirth (1938) said that social relationships in...\nvariables    {\"A\": \"they were confined to particular areas ...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                          mmlu-sociology\nsplit                                               validation\nName: 13131, dtype: object\n--------------------------------------------------------------------------------\nmmlu-us_foreign_policy\nquestion     The realm of policy decisions concerned primar...\nvariables    {\"A\": \"terrorism policy.\", \"B\": \"economic poli...\ntarget                                                       C\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                  mmlu-us_foreign_policy\nsplit                                                    train\nName: 13149, dtype: object\n--------------------------------------------------------------------------------\nmmlu-virology\nquestion     In a survey of 10,000 IV drug users in town A,...\nvariables    {\"A\": \"1,000/10,000\", \"B\": \"1,100/10,000\", \"C\"...\ntarget                                                       B\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                           mmlu-virology\nsplit                                               validation\nName: 1543, dtype: object\n--------------------------------------------------------------------------------\nmmlu-world_religions\nquestion        Who was the immediate successor to Guru Nanak?\nvariables    {\"A\": \"Guru Angad\", \"B\": \"His son\", \"C\": \"Guru...\ntarget                                                       A\ndataset                                                   mmlu\nformatter                                                 mmlu\nsubset                                    mmlu-world_religions\nsplit                                               validation\nName: 12919, dtype: object\n--------------------------------------------------------------------------------\n\n\n\nformatters = {}\nformatters[\"bbh-boolean_expressions\"] = \"USER: Calculate the following expression {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-boolean_expressions-no-cot\"] = \"USER: Calculate the following expression {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-boolean_expressions-cot\"] = formatters[\"bbh-boolean_expressions\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-causal_judgement\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-causal_judgement-cot\"] = formatters[\"bbh-causal_judgement\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-causal_judgement-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-date_understanding\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-date_understanding-cot\"] = formatters[\"bbh-date_understanding\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-date_understanding-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-disambiguation_qa\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-disambiguation_qa-cot\"] = formatters[\"bbh-disambiguation_qa\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-disambiguation_qa-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-dyck_languages\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-dyck_languages-cot\"] = formatters[\"bbh-dyck_languages\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-dyck_languages-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-formal_fallacies\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-formal_fallacies-cot\"] = formatters[\"bbh-formal_fallacies\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-formal_fallacies-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt; \"\nformatters[\"bbh-geometric_shapes\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-geometric_shapes-cot\"] = formatters[\"bbh-geometric_shapes\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-geometric_shapes-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt; \"\nformatters[\"bbh-hyperbaton\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-hyperbaton-cot\"] = formatters[\"bbh-hyperbaton\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-hyperbaton-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_five_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-logical_deduction_five_objects-cot\"] = formatters[\"bbh-logical_deduction_five_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_five_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_seven_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-logical_deduction_seven_objects-cot\"] = formatters[\"bbh-logical_deduction_seven_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_seven_objects-no-cot\"] = \"USER: {question}. Give an immediate answer &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_three_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-logical_deduction_three_objects-cot\"] = formatters[\"bbh-logical_deduction_three_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-logical_deduction_three_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-movie_recommendation\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-movie_recommendation-cot\"] = formatters[\"bbh-movie_recommendation\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-movie_recommendation-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-multistep_arithmetic_two\"] = \"USER: I have the following math expression, calculate it `{question}`. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-multistep_arithmetic_two-cot\"] = formatters[\"bbh-multistep_arithmetic_two\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-multistep_arithmetic_two-no-cot\"] = \"USER: I have the following math expression, calculate it `{question}`. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-navigate\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-navigate-cot\"] = formatters[\"bbh-navigate\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-navigate-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-object_counting\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-object_counting-cot\"] = formatters[\"bbh-object_counting\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-object_counting-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-penguins_in_a_table\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-penguins_in_a_table-cot\"] = formatters[\"bbh-penguins_in_a_table\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-penguins_in_a_table-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-reasoning_about_colored_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-reasoning_about_colored_objects-cot\"] = formatters[\"bbh-reasoning_about_colored_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-reasoning_about_colored_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-ruin_names\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-ruin_names-cot\"] = formatters[\"bbh-ruin_names\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-ruin_names-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-salient_translation_error_detection\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-salient_translation_error_detection-cot\"] = formatters[\"bbh-salient_translation_error_detection\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-salient_translation_error_detection-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-snarks\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-snarks-cot\"] = formatters[\"bbh-snarks\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-snarks-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-sports_understanding\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-sports_understanding-cot\"] = formatters[\"bbh-sports_understanding\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-sports_understanding-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-temporal_sequences\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-temporal_sequences-cot\"] = formatters[\"bbh-temporal_sequences\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-temporal_sequences-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_five_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-tracking_shuffled_objects_five_objects-cot\"] = formatters[\"bbh-tracking_shuffled_objects_five_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_five_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_seven_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-tracking_shuffled_objects_seven_objects-cot\"] = formatters[\"bbh-tracking_shuffled_objects_seven_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_seven_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_three_objects\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-tracking_shuffled_objects_three_objects-cot\"] = formatters[\"bbh-tracking_shuffled_objects_three_objects\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-tracking_shuffled_objects_three_objects-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-web_of_lies\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-web_of_lies-cot\"] = formatters[\"bbh-web_of_lies\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-web_of_lies-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-word_sorting\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"bbh-word_sorting-cot\"] = formatters[\"bbh-word_sorting\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"bbh-word_sorting-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"gsm8k\"] = \"USER: {question}. &lt;s&gt; ASSISTANT: Let's think step by step. {chain_of_thoughts} \"\nformatters[\"gsm8k-cot\"] = formatters[\"gsm8k\"] + \" &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"gsm8k-no-cot\"] = \"USER: {question}. Give an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt; \"\nformatters[\"humaneval\"] = \"USER: We have the following code ```\\n{question}\\n``` and tests ```{test}```, help me write main code. &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"humaneval-cot\"] = formatters[\"humaneval\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: ```\\n{target}\\n``` &lt;s&gt;\"\nformatters[\"humaneval-no-cot\"] = \"USER: We have the following code ```\\n{question}\\n``` and tests ```{test}```, help me write main code. Give an immediate answer. &lt;s&gt; ASSISTANT: ```\\n{target}\\n``` &lt;s&gt;\"\nformatters[\"mmlu\"] = \"USER: {question}\\nA: {A}\\nB: {B}\\nC: {C}\\nD: {D} &lt;s&gt; ASSISTANT: Let's think step by step. \"\nformatters[\"mmlu-cot\"] = formatters[\"mmlu\"] + \" {chain_of_thoughts} &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\nformatters[\"mmlu-no-cot\"] = \"USER: {question}\\nA: {A}\\nB: {B}\\nC: {C}\\nD: {D}\\nGive an immediate answer. &lt;s&gt; ASSISTANT: {target} &lt;s&gt;\"\n\n\nfor formatter in formatters:\n    if formatter.endswith(\"-cot\"):\n        continue\n    assert f\"{formatter}-cot\" in formatters, f\"No {formatter}-cot\"\n    assert f\"{formatter}-no-cot\" in formatters, f\"No {formatter}-no-cot\"\n\n\npd.Series(formatters).reset_index().rename(columns={\"index\": \"formatter\", 0: \"text\"}).to_csv(\"formatters.csv\", index=False)\n\n\ndf.to_csv(\"llama-reasoning.csv\", index=False)"
  }
]